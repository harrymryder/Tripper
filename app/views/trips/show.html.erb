<style>
    .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
</style>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.48.0/mapbox-gl.js'></script>
<div class="trip-container">

  <div class="cards-wrap">
    <h4>To Do in <%= @trip.start_location %>...</h4>
    <div class="cards-container">
      <div class="row">

        <% @pois = PointOfInterest.where(country: @trip.start_location) %>
        <% @pois.each do |poi| %>
          <div class="col-xs-12 ">

            <% if @trip.legs.find_by(point_of_interest_id: poi.id).nil? %>
              <div class="card-box card-box-plus card-live" id="<%= poi[:name] %>" data-name="<%= poi[:name] %>">
                <h5><%= poi.name %></h5>


                <div id="createLeg<%= poi.id %>" class="add-to-trip">
                  <%= render 'legs/create_button', trip: @trip, poi_id: poi.id %>
                </div>



                <% @id_poi = poi.id %>
                <div class="card-description"><p><%= poi.description %></p></div>
                <%= image_tag poi.photo, class: "card-img" %>
                <div class="read-more"></div>
                <p class="card-btn read-more-btn btn btn-primary" id="toggle">Read more</p>
              </div>
            <% else %>
              <div class="card-box card-box-minus card-live" id="<%= poi[:name] %>" data-name="<%= poi[:name] %>">
                <h5><%= poi.name %></h5>
                <% leg = Leg.find_by(point_of_interest_id: poi.id) %>

                <div data-id="<%= poi.id %>" class="remove-from-trip">
                  <%= render 'legs/destroy_button', trip: @trip, poi: poi, leg: leg %>
                </div>

                <% @id_poi = poi.id %>
                <div class="card-description"><p><%= poi.description %></p></div>
                <%= image_tag poi.photo, class: "card-img" %>
                <p class="card-btn read-more-btn btn btn-primary" id="toggle">Read More</p>
              </div>
            <% end %>
          </div>

        <% end %>
      </div>
    </div>
  </div>

  <div class="map-container">
    <div id='map' data-pin = "<%= asset_path('pin.png')%>" data-bluepin = "<%= asset_path('blue-pin.png')%>" data-markers = "<%= @markers.to_json %>" data-legs = "<%= @leg_list.to_json %>"></div>
    <div class="optimize-button">
      <p>Calculate Optimized Route</p>
    </div>
  </div>

</div>

<% first_poi = @pois[0] %>


<div class="number-of-days-left">
  <h5>Number of Days Left</h5>
  <p id="days-integer"><%= @time_left %></p>
</div>

<div class="timeline-container">
  <div class="timeline">
    <ul>
      <% @pois.each do |poi| %>
        <% leg = Leg.find_by(point_of_interest_id: poi.id) %>
        <% if leg.present? %>
          <li>
            <div class="timeline-content">
              <h5><%= poi.name %></h5>
              <p><%= poi.description %></p>
              <p class="duration"></p>
              <div class="los_form form-inline">
                <%= simple_form_for leg, remote: true do |f| %>
                  <%= f.input :length_of_stay, label: "How many days would you like to stay?", class: 'length_of_stay form-control' %>
                  <%= f.submit 'Confirm', class: 'submit' %>
                <% end %>
              </div>
            </div>
          </li>
         <% end %>
      <% end %>
      <li>
        <div class="timeline-content">
          <h5><%= first_poi.name %></h5>
          <p><%= first_poi.description %></p>
        </div>
      </li>
    </ul>
  </div>
</div>
<script>
var removeButton = document.querySelectorAll(".remove-from-trip");

removeButton.forEach(function(element) {
  element.addEventListener("click", function work(e) {
    e.currentTarget.innerHTML = "<%= j render 'legs/create_button', trip: @trip, poi_id: @poi_id %>";
  })
    // e.removeEventListener("click", work, true)
});

</script>


<%= javascript_pack_tag "map" %>
<%= javascript_pack_tag "timeline" %>
<%= javascript_pack_tag "cards" %>


