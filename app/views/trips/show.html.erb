<style>
    .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
</style>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.48.0/mapbox-gl.js'></script>
<div class="trip-container">

  <div class="cards-wrap">
    <h4>CUSTOMISE YOUR TRIP</h4>
    <p>Add and remove activities to your trip and click 'optimize your route' when you think you're finished</p>
    <div class="cards-container">
      <div class="row">

        <% @pois = PointOfInterest.where(country: @trip.start_location) %>
        <% @pois.each do |poi| %>
          <div class="col-xs-12 ">
            <% if Leg.find_by(point_of_interest_id: poi.id).nil? %>
            <div class="card-box-plus card-live" id="<%= poi[:name] %>" data-name="<%= poi[:name] %>">
              <h5><%= poi.name %></h5>
                <%= link_to trip_legs_path(@trip, poi_id: poi.id) , method: :post  do  %>
                  <i class="fas fa-plus plus"></i>
                <% end %>
              <div class="card-description">
                <% @id_poi = poi.id %>
                <p><%= poi.description %></p>
                <%= image_tag poi.photo, class: "card-img" %>

              </div>
            </div>
            <% else %>
            <div class="card-box-minus card-live" id="<%= poi[:name] %>" data-name="<%= poi[:name] %>">
              <h5><%= poi.name %></h5>
              <% bla = Leg.find_by(point_of_interest_id: poi.id) %>

                <%= link_to trip_leg_path(@trip, bla), method: :delete  do  %>
                  <i class="fas fa-minus minus"></i>
                <% end %>
              <div class="card-description">
                <% @id_poi = poi.id %>
                <p><%= poi.description %></p>
                <%= image_tag poi.photo, class: "card-img" %>
              </div>
            </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="map-container">
    <div id='map' data-pin = "<%= asset_path('pin.png')%>" data-bluepin = "<%= asset_path('blue-pin.png')%>" data-markers = "<%= @markers.to_json %>" data-legs = "<%= @leg_list.to_json %>"></div>
    <div class="optimize-button">
      <p>Calculate Optimized Route</p>
    </div>
  </div>

</div>

<% first_poi = @pois[0] %>

<div class="timeline-container">
  <h4>Your Trip</h4>

  <section class="timeline">
    <ul>
      <% @pois.each do |poi| %>
        <% if Leg.find_by(point_of_interest_id: poi.id).present? %>
          <li class="itinerary-card">
            <div>
              <h5><%= poi.name %></h5>
              <p><%= poi.description %></p>
            </div>
          </li>
          <li class="itinerary-duration">
            <div>
              <p>Travel time to next destination:<p>
              <p class="duration"></p>
            </div>
          </li>
        <% end %>
      <% end %>
      <li class="itinerary-card">
        <div>
          <h5><%= first_poi.name %></h5>
          <p><%= first_poi.description %></p>
        </div>
      </li>
    </ul>
  </section>
</div>


<%= javascript_pack_tag "map" %>
<%= javascript_pack_tag "timeline" %>


